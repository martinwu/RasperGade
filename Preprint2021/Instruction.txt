# Instructions to reproduce results in preprint
### Make sure you have installed RasperGade and its dependencies properly

# Simulation of pulsed evolution and time-independent variation
## Run the following commands through Linux or MacOS command line
## Commands used here use 15 cores, adjust 15 to a number compatible with your device

### Simulations for scheme 1
mkdir -p Result/Scheme1
Rscript simulation_cases.R Data/Bacteria.tre 15 Result/Scheme1/Scheme1.BM_ 0 5 0
Rscript simulation_cases.R Data/Bacteria.tre 15 Result/Scheme1/Scheme1.BME_ 10 5 0
Rscript simulation_cases.R Data/Bacteria.tre 15 Result/Scheme1/Scheme1.PEBM_ 0 5 0.9
Rscript simulation_cases.R Data/Bacteria.tre 15 Result/Scheme1/Scheme1.PEBME_ 10 5 0.9

### Simulations for scheme 2
mkdir -p Result/Scheme2
Rscript simulation_Epsilon_only.R Data/Bacteria.tre 15 Result/Scheme2/Scheme2
Rscript simulation_contribution_PEonly.R Data/Bacteria.tre 15 Result/Scheme2/Scheme2

# Reproduce figures for simulations
## Run the following scripts
Rscript StatisticBaseline.R
Rscript Figure1_3_S1S3_Table1_S1S3.R
Rscript FigS2.R
Rscript FigS4.R

# Fitting pulsed evolution model for empirical data
## Run the following commands through Linux or MacOS command line
## Commands used here use 15 cores, adjust 15 to a number compatible with your device
mkdir -p Result/Empirical
Rscript fit_3models_normal.R Data/Bacteria.tre Data/genomic_GC.logit.txt Result/Empirical/gGC 15 3 3 1
Rscript fit_3models_normal.R Data/Bacteria.tre Data/rRNA_stem_GC.logit.txt Result/Empirical/rGC 15 3 3 1
Rscript fit_3models_normal.R Data/Bacteria.tre Data/genome_size.log.txt Result/Empirical/GS 15 3 3 1
Rscript fit_3models_normal.R Data/Bacteria.tre Data/N_ARSC.log.txt Result/Empirical/N 15 3 3 1
Rscript fit_3models_normal_jitter.R Data/Bacteria.tre Data/16S_GCN.txt Result/Empirical/rrn 15 3 0.01 -1
Rscript fit_3models_normal_composite.R Data/Landis.data.RDS Data/Landis.PE.index.RDS Result/Empirical/BodySize 15 3 3 1

# Reconstruction and plot for empirical data
## Run the following scripts
Rscript reconstruction_Landis.R
Rscript reconstruction_Bacteria.R
